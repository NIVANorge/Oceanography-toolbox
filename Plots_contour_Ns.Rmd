---
title: "Plotting contour plots from water column stations"
author: "Helene"
date: "18 Feb 2022"
output: github_document:
    toc: true
  html_document:
    toc: true    
    toc_float: true
    code_folding: hide
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_format = "all", output_dir = "../Produced_documents") })

---

* NB uses cleaned datset made in script "Read_and_check_AqM_files.Rmd".

## 0. Libraries
```{r, error = F, warning = F}

# clean workspace
rm(list=ls())

#library (caTools)
library (lubridate)
library (dplyr)
#install.packages ("vctrs")
#install.packages ("ellipsis")
#library (vctrs)
#library (ellipsis)
library(tidyr)     # 
#library(purrr)     # for map_dbl
#install.packages ("rMR")
#library (rMR) # calculate O2 saturation
#library (seacarb)
library(akima) # for interpolations
library(ggplot2)
library(readxl)
library(mgcv)     # for gam() in plots
library(patchwork) # for arranging plots in panels
library(tidyverse)
library(scales)

library(RColorBrewer)
# specific functions needed for the contour plots

# NB! this source file contains the function (used by okokyst_plot function here), and needs to be saved in the same folder as this script

source("okokyst_plot_functions_LOV.R")# new version in 2021

# Use a self-defined color scale  
jet.colors <- colorRampPalette(c("#00007F", "blue", "#007FFF", "cyan", "#7FFF7F", "yellow", "#FF7F00", "red", "#7F0000"))

colors <- rev(brewer.pal(10, "RdYlBu"))
rgb.palette <- colorRampPalette(colors)

```


## 1. Read and clean files
### a. read
* this file is produced in script "Read_and_check_OKOKYST_Klima.Rmd"
```{r}

# clear workspace
#rm(list = ls())

#dir("Datasett")

df <- read.delim ("Datasett/OKOKYST_data_cleaned_Ns_test.txt")

#str(df)

# convert back to Date
df$Date <- as.Date(df$Date, "%d.%m.%Y")
#str(df)

# station naming, convert back to factor
#df$StationId <- as.factor (df$StationId)



#find out where in the dataset there is high extreme values
extreme_values <- df %>% filter((TOTN > 800) | (SIO2 > 2000) | (TOTP > 100) | (NH4 > 400))
#remove the extreme values from dataset
df <- df %>% filter(((TOTN < 800)  %>% replace_na(TRUE)) , ((SIO2  < 2000) %>% replace_na(TRUE)) , ((TOTP < 100)%>% replace_na(TRUE)) , ((NH4 < 400)%>% replace_na(TRUE)))

#select years
df <- subset(df, Date >= "2017-01-01" &  Date <= "2021-11-30")

```

### b. Clean data for contour plots, summarizing for depths
* the interpolation in okokyst_plot() does not like a lot of missing data. so I make a dataset that has only the 5 depths for disceret stations (0-30m), average the dataset for those depths, and make on separate dataset for each station. this can probably be done in many different ways, but I found this works for me... 
```{r}

#str (df)

# For water chemistry variables with discrete depths (0-30m), NB! you need to replace with the column names in the file you use!  remove NA values
df_chem <- df %>%
  select(-Depth2)  %>%
   #filter (Depth1 == 0 | Depth1 == 5| Depth1 == 10 | Depth1 == 20 | Depth1 == 30) %>%
   rename (Depth = Depth1) 




# make df for each station, NB replace with the stations you use (needed for okokyst_plot function)

VT70 <- df_chem %>%
  filter(StationId == "VT70")

VT74 <- df_chem %>%
  filter(StationId == "VT74")

VT79 <- df_chem %>%
  filter(StationId == "VT79")

VT53 <- df_chem %>%
  filter(StationId == "VT53")

VR49 <- df_chem %>%
  filter(StationId == "VR49")

VR48 <- df_chem %>%
  filter(StationId == "VR48")

VT8 <- df_chem %>%
  filter(StationId == "VT8")

VT16 <- df_chem %>%
  filter(StationId == "VT16")



```

## 2. Contour plots

### o. example from Dag 13.04.2021 - just for showing differnt functionality and testing
```{r}
## Using okokyst_plot() function ---- 

# Basic plot
# debugonce(okokyst_plot)
okokyst_plot(VR54, "DOC")

# Don't show the coloured points (can instead use 'colored_points_size' to adjust size)
okokyst_plot(VR54, "KlfA", colored_points = FALSE)

# If you want to remove part of the background colors, then
# (1) first use okokyst_make_plotdata()  (here, we call the result 'my_plotdata')
# (2) select the part of the data and store the result (here, called 'sel')
# (3) set the variable 'z' in the dataset from 1 ('my_plotdata') to be NA for all selected rows ('sel')
# (4) use okokyst_plot() as before, but set plotdata = the name of the dataset from 1 (here, 'my_plotdata') 
# Example:
my_plotdata <- okokyst_make_plotdata(df2, "KlfA")  
sel <- with(my_plotdata, Time >= dmy("01.05.2020") & Time <= dmy("31.05.2020") & Depth < 15)
my_plotdata$z[sel] <- NA
okokyst_plot(df2, "KlfA", plotdata = my_plotdata)

# Try GAM (doesn't work well in this case)
okokyst_plot(VR54, "KlfA", gam = TRUE, gam_k = 5)

# Try a different palette (you can set palette = 'A', 'B', 'C' or 'D' - the default is D)
okokyst_plot(VR54, "KlfA", palette = "C")

# Turn colors "upside down" (setting colored_points_rim = TRUE to see points in all parts)
okokyst_plot(VR54, "KlfA", palette = "A", 
             reverse_colors = TRUE, colored_points_rim = TRUE)

okokyst_plot(VR54, "KlfA") +
  scale_fill_gradientn(colours = jet.colors(16))

```



### a. Here is an example for NO3 for two stations, this can of course be adapted for all different stations/variables

#### VR48 TOTN
```{r}

# check range, can be set automatically, but I often found the plot looks nicer if you set manually
quantile(VR48$TOTN, na.rm = T)

# with colored points and date label every 2nd month (depends on length of the timeseries for the station)
# NB! here I set the labels = null (compare with VT71 below), because I want to have them on top of eachother in a panel (see 3. Combine figures below)

grenser <- c(0,500)
VR48_TOTN <- okokyst_plot(data = VR48, varname = "TOTN", ctd_variable = F,
                   colored_points = T, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn("TOTN", colours = jet.colors(20), limits= grenser, breaks = c(100,200,300,400), oob=squish) +
                    scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VR48_TOTN

#ggsave ("Figures/VR48/VR48_TOTN.png", dpi=500, width = 8, height = 3)


```



#### VR48 NO3
```{r}

quantile (VR48$NO3_NO2, na.rm = T)

# med punkter

grenser <- c(0,200)
VR48_NO3 <- okokyst_plot(data = VR48, varname = "NO3_NO2", ctd_variable = FALSE,
                   colored_points = TRUE, limits =grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("NO"[3]* "+ NO"[2]), colours = jet.colors(16), breaks = c(50,100,150), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VR48_NO3

#ggsave ("Figures/VR48/VR48_NO3.png", dpi=500, width = 8, height = 3)
 
```
#### VR48 NH4
```{r}

quantile (VR48$NH4, na.rm = T)

# med punkter
grenser <- c(0,80)
VR48_NH4 <- okokyst_plot(data = VR48, varname = "NH4", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("NH"[4]), limit=grenser, colours = jet.colors(16), breaks = c(20,40,60), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", date_labels =  "%b %y") +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VR48_NH4

#ggsave ("Figures/VR48/VR48_NH4.png", dpi=500, width = 8, height = 3)


```


####


## 3. Combine figures (with patchwork library)
```{r}
# combine figures, here combine two NO3 for different stations
#NB can of curse combine different variables for one station as well 
Nitrogen <- VR48_TOTN +  VR48_NO3 + VR48_NH4 + plot_layout(ncol = 1, width = 8, height =6)
plot (Nitrogen)
  ggsave("Figures/VR48/VR48_nitrogen_panel_test.png", plot = Nitrogen,  width = 8, height = 6)
  
```

####VR48 PO4

```{r}

quantile (VR48$PO4, na.rm = T)

# med punkter

grenser <- c(0,60)
VR48_PO4 <- okokyst_plot(data = VR48, varname = "PO4", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("PO"[4]), colours = jet.colors(16), limits=grenser, breaks = c(10,20,30,40,50), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)
 
                      #theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))

VR48_PO4

#ggsave ("Figures/VR48/VR48_PO4.png", dpi=500, , width = 8, height = 3)
```

####VR48 TOTP
```{r}
quantile (VR48$TOTP, na.rm = T)

# med punkter

grenser <- c(0,60)
VR48_TOTP <- okokyst_plot(data = VR48, varname = "TOTP", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn("TOTP", colours = jet.colors(16), limits=grenser, breaks = c(10,20,30,40,50), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VR48_TOTP

#ggsave ("Figures/VR48/VR48_TOTP.png", dpi=500, width = 8, height = 3)
```


####VR48 SIO2

```{r}

quantile (VR48$SIO2, na.rm = T)
rm
# med punkter
grenser <- c(0,900)
VR48_SIO2 <- okokyst_plot(data = VR48, varname = "SIO2", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("SiO"[2]), colours = jet.colors(16),limits=grenser,breaks = c(200,400,600,800), oob=squish ) +
                       scale_x_datetime(date_breaks = "2 month", date_labels =  "%b %y") +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VR48_SIO2

#ggsave ("Figures/VR48/VR48_SIO2.png", dpi=500, width = 8, height = 3)

```

##cOMBINE 
```{r}
# combine figures, here combine two NO3 for different stations
#NB can of curse combine different variables for one station as well 
VR48_fosfat_Si <- VR48_TOTP +  VR48_PO4 + VR48_SIO2 +  plot_layout(ncol = 1,  width = 8, height = 6)
plot (VR48_fosfat_Si)
ggsave("Figures/VR48/VR48_fosfat_Si_panel.png", plot = VR48_fosfat_Si,  width = 8, height = 6)
```
  
```
#### VR48 klfa
```{r}
quantile (VR48$KlfA, na.rm = T)

# med punkter
grenser <- c(0,5)
VR48_KlfA <- okokyst_plot(data = VR48, varname = "KlfA", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                      scale_fill_gradientn("KlfA", colours = jet.colors(16),limits=grenser, breaks = c(1,2,3,4), oob=squish) +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VR48_KlfA 

ggsave ("Figures/VR48/VR48_KlfA.png" , width = 8, height = 3)
```



#### VT8 TOTN

```{r}

# check range, can be set automatically, but I often found the plot looks nicer if you set manually
quantile(VT8$TOTN, na.rm = T)

# with colored points and date label every 2nd month (depends on length of the timeseries for the station)
# NB! here I set the labels = null (compare with VT71 below), because I want to have them on top of eachother in a panel (see 3. Combine figures below)

grenser <- c(0,500)
VT8_TOTN <- okokyst_plot(data = VT8, varname = "TOTN", ctd_variable = F,
                   colored_points = T, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn("TOTN", colours = jet.colors(20), limits= grenser, breaks = c(100,200,300,400), oob=squish) +
                    scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VT8_TOTN

ggsave ("Figures/VT8/VT8_TOTN.png", dpi=500, width = 8, height = 3)


```



#### VT8 NO3
```{r}

quantile (VT8$NO3_NO2, na.rm = T)

# med punkter

grenser <- c(0,200)
VT8_NO3 <- okokyst_plot(data = VT8, varname = "NO3_NO2", ctd_variable = FALSE,
                   colored_points = TRUE, limits =grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("NO"[3]* "+ NO"[2]), colours = jet.colors(16), breaks = c(50,100,150), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VT8_NO3

ggsave ("Figures/VT8/VT8_NO3.png", dpi=500, width = 8, height = 3)
 
```
#### VT8 NH4
```{r}

quantile (VT8$NH4, na.rm = T)

# med punkter
grenser <- c(0,80)
VT8_NH4 <- okokyst_plot(data = VT8, varname = "NH4", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("NH"[4]), limit=grenser, colours = jet.colors(16), breaks = c(20,40,60), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", date_labels =  "%b %y") +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VT8_NH4

ggsave ("Figures/VT8/VT8_NH4.png", dpi=500, width = 8, height = 3)


```


####


## 3. Combine figures (with patchwork library)
```{r}
# combine figures, here combine two NO3 for different stations
#NB can of curse combine different variables for one station as well 
Nitrogen <- VT8_TOTN +  VT8_NO3 + VT8_NH4 + plot_layout(ncol = 1, width = 8, height =6)
plot (Nitrogen)
  ggsave("Figures/VT8/VT8_nitrogen_panel_test.png", plot = Nitrogen,  width = 8, height = 6)
  
```

####VT8 PO4

```{r}

quantile (VT8$PO4, na.rm = T)

# med punkter

grenser <- c(0,60)
VT8_PO4 <- okokyst_plot(data = VT8, varname = "PO4", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("PO"[4]), colours = jet.colors(16), limits=grenser, breaks = c(10,20,30,40,50), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)
 
                      #theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))

VT8_PO4

ggsave ("Figures/VT8/VT8_PO4.png", dpi=500, , width = 8, height = 3)
```

####VT8 TOTP
```{r}
quantile (VT8$TOTP, na.rm = T)

# med punkter

grenser <- c(0,60)
VT8_TOTP <- okokyst_plot(data = VT8, varname = "TOTP", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn("TOTP", colours = jet.colors(16), limits=grenser, breaks = c(10,20,30,40,50), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VT8_TOTP

ggsave ("Figures/VT8/VT8_TOTP.png", dpi=500, width = 8, height = 3)
```


####VT8 SIO2

```{r}

quantile (VT8$SIO2, na.rm = T)
rm
# med punkter
grenser <- c(0,900)
VT8_SIO2 <- okokyst_plot(data = VT8, varname = "SIO2", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("SiO"[2]), colours = jet.colors(16),limits=grenser,breaks = c(200,400,600,800), oob=squish ) +
                       scale_x_datetime(date_breaks = "2 month", date_labels =  "%b %y") +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VT8_SIO2

ggsave ("Figures/VT8/VT8_SIO2.png", dpi=500, width = 8, height = 3)

```

##cOMBINE 
```{r}
# combine figures, here combine two NO3 for different stations
#NB can of curse combine different variables for one station as well 
VT8_fosfat_Si <- VT8_TOTP +  VT8_PO4 + VT8_SIO2 +  plot_layout(ncol = 1,  width = 8, height = 6)
plot (VT8_fosfat_Si)
ggsave("Figures/VT8/VT8_fosfat_Si_panel.png", plot = VT8_fosfat_Si,  width = 8, height = 6)
```
  
```
#### VT8 klfa
```{r}
quantile (VT8$KlfA, na.rm = T)

# med punkter
grenser <- c(0,5)
VT8_KlfA <- okokyst_plot(data = VT8, varname = "KlfA", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                      scale_fill_gradientn("KlfA", colours = jet.colors(16),limits=grenser, breaks = c(1,2,3,4), oob=squish) +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VT8_KlfA 

ggsave ("Figures/VT8/VT8_KlfA.png" , width = 8, height = 3)
```



#### VR49 TOTN
```{r}

# check range, can be set automatically, but I often found the plot looks nicer if you set manually
quantile(VR48$TOTN, na.rm = T)

# with colored points and date label every 2nd month (depends on length of the timeseries for the station)
# NB! here I set the labels = null (compare with VT71 below), because I want to have them on top of eachother in a panel (see 3. Combine figures below)

grenser <- c(0,500)
VR49_TOTN <- okokyst_plot(data = VR49, varname = "TOTN", ctd_variable = F,
                   colored_points = T, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn("TOTN", colours = jet.colors(20), limits= grenser, breaks = c(100,200,300,400), oob=squish) +
                    scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VR49_TOTN

ggsave ("Figures/VR49/VR49_TOTN.png", dpi=500, width = 8, height = 3)


```



#### VR49 NO3
```{r}

quantile (VR49$NO3_NO2, na.rm = T)

# med punkter

grenser <- c(0,200)
VR49_NO3 <- okokyst_plot(data = VR49, varname = "NO3_NO2", ctd_variable = FALSE,
                   colored_points = TRUE, limits =grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("NO"[3]* "+ NO"[2]), colours = jet.colors(16), breaks = c(50,100,150), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VR49_NO3

ggsave ("Figures/VR49/VR49_NO3.png", dpi=500, width = 8, height = 3)
 
```
#### VR49 NH4
```{r}

quantile (VR49$NH4, na.rm = T)

# med punkter
grenser <- c(0,80)
VR49_NH4 <- okokyst_plot(data = VR49, varname = "NH4", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("NH"[4]), limit=grenser, colours = jet.colors(16), breaks = c(20,40,60), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", date_labels =  "%b %y") +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VR49_NH4

ggsave ("Figures/VR49/VR49_NH4.png", dpi=500, width = 8, height = 3)


```


####


## 3. Combine figures (with patchwork library)
```{r}
# combine figures, here combine two NO3 for different stations
#NB can of curse combine different variables for one station as well 
Nitrogen <- VR49_TOTN +  VR49_NO3 + VR49_NH4 + plot_layout(ncol = 1, width = 8, height =6)
plot (Nitrogen)
  ggsave("Figures/VR49/VR49_nitrogen_panel_test.png", plot = Nitrogen,  width = 8, height = 6)
  
```

####VR49 PO4

```{r}

quantile (VR49$PO4, na.rm = T)

# med punkter

grenser <- c(0,60)
VR49_PO4 <- okokyst_plot(data = VR49, varname = "PO4", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("PO"[4]), colours = jet.colors(16), limits=grenser, breaks = c(10,20,30,40,50), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)
 
                      #theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))

VR49_PO4

ggsave ("Figures/VR49/VR49_PO4.png", dpi=500, , width = 8, height = 3)
```

####VR49 TOTP
```{r}
quantile (VR49$TOTP, na.rm = T)

# med punkter

grenser <- c(0,60)
VR49_TOTP <- okokyst_plot(data = VR49, varname = "TOTP", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn("TOTP", colours = jet.colors(16), limits=grenser, breaks = c(10,20,30,40,50), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VR49_TOTP

ggsave ("Figures/VR49/VR49_TOTP.png", dpi=500, width = 8, height = 3)
```


####VR49 SIO2

```{r}

quantile (VR49$SIO2, na.rm = T)

# med punkter
grenser <- c(0,900)
VR49_SIO2 <- okokyst_plot(data = VR49, varname = "SIO2", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("SiO"[2]), colours = jet.colors(16),limits=grenser,breaks = c(200,400,600,800), oob=squish ) +
                       scale_x_datetime(date_breaks = "2 month", date_labels =  "%b %y") +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VR49_SIO2

ggsave ("Figures/VR49/VR49_SIO2.png", dpi=500, width = 8, height = 3)

```

##cOMBINE 
```{r}
# combine figures, here combine two NO3 for different stations
#NB can of curse combine different variables for one station as well 
VR49_fosfat_Si <- VR49_TOTP +  VR49_PO4 + VR49_SIO2 +  plot_layout(ncol = 1,  width = 8, height = 6)
plot (VR49_fosfat_Si)
ggsave("Figures/VR49/VR49_fosfat_Si_panel.png", plot = VR49_fosfat_Si,  width = 8, height = 6)
```
  
```
#### VR49 klfa
```{r}
quantile (VR49$KlfA, na.rm = T)

# med punkter
grenser <- c(0,5)
VR49_KlfA <- okokyst_plot(data = VR49, varname = "KlfA", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                      scale_fill_gradientn("KlfA", colours = jet.colors(16),limits=grenser, breaks = c(1,2,3,4), oob=squish) +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VR49_KlfA 

ggsave ("Figures/VR49/VR49_KlfA.png" , width = 8, height = 3)
```



#### VT16 TOTN
```{r}

# check range, can be set automatically, but I often found the plot looks nicer if you set manually
quantile(VR48$TOTN, na.rm = T)

# with colored points and date label every 2nd month (depends on length of the timeseries for the station)
# NB! here I set the labels = null (compare with VT71 below), because I want to have them on top of eachother in a panel (see 3. Combine figures below)

grenser <- c(0,500)
VT16_TOTN <- okokyst_plot(data = VT16, varname = "TOTN", ctd_variable = F,
                   colored_points = T, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn("TOTN", colours = jet.colors(20), limits= grenser, breaks = c(100,200,300,400), oob=squish) +
                    scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VT16_TOTN

ggsave ("Figures/VT16/VT16_TOTN.png", dpi=500, width = 8, height = 3)


```



#### VT16 NO3
```{r}

quantile (VT16$NO3_NO2, na.rm = T)

# med punkter

grenser <- c(0,200)
VT16_NO3 <- okokyst_plot(data = VT16, varname = "NO3_NO2", ctd_variable = FALSE,
                   colored_points = TRUE, limits =grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("NO"[3]* "+ NO"[2]), colours = jet.colors(16), breaks = c(50,100,150), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VT16_NO3

ggsave ("Figures/VT16/VT16_NO3.png", dpi=500, width = 8, height = 3)
 
```
#### VT16 NH4
```{r}

quantile (VT16$NH4, na.rm = T)

# med punkter
grenser <- c(0,80)
VT16_NH4 <- okokyst_plot(data = VT16, varname = "NH4", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("NH"[4]), limit=grenser, colours = jet.colors(16), breaks = c(20,40,60), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", date_labels =  "%b %y") +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VT16_NH4

ggsave ("Figures/VT16/VT16_NH4.png", dpi=500, width = 8, height = 3)


```


####


## 3. Combine figures (with patchwork library)
```{r}
# combine figures, here combine two NO3 for different stations
#NB can of curse combine different variables for one station as well 
Nitrogen <- VT16_TOTN +  VT16_NO3 + VT16_NH4 + plot_layout(ncol = 1, width = 8, height =6)
plot (Nitrogen)
  ggsave("Figures/VT16/VT16_nitrogen_panel_test.png", plot = Nitrogen,  width = 8, height = 6)
  
```

####VT16 PO4

```{r}

quantile (VT16$PO4, na.rm = T)

# med punkter

grenser <- c(0,60)
VT16_PO4 <- okokyst_plot(data = VT16, varname = "PO4", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("PO"[4]), colours = jet.colors(16), limits=grenser, breaks = c(10,20,30,40,50), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)
 
                      #theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))

VT16_PO4
#ggsave ("Figures/VT16/VT16_PO4.png", dpi=500, , width = 8, height = 3)
```

####VT16 TOTP
```{r}
quantile (VT16$TOTP, na.rm = T)

# med punkter

grenser <- c(0,60)
VT16_TOTP <- okokyst_plot(data = VT16, varname = "TOTP", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn("TOTP", colours = jet.colors(16), limits=grenser, breaks = c(10,20,30,40,50), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VT16_TOTP

ggsave ("Figures/VT16/VT16_TOTP.png", dpi=500, width = 8, height = 3)
```


####VT16 SIO2

```{r}

quantile (VT16$SIO2, na.rm = T)
rm
# med punkter
grenser <- c(0,900)
VT16_SIO2 <- okokyst_plot(data = VT16, varname = "SIO2", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("SiO"[2]), colours = jet.colors(16),limits=grenser,breaks = c(200,400,600,800), oob=squish ) +
                       scale_x_datetime(date_breaks = "2 month", date_labels =  "%b %y") +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VT16_SIO2

ggsave ("Figures/VT16/VT16_SIO2.png", dpi=500, width = 8, height = 3)

```

##cOMBINE 
```{r}
# combine figures, here combine two NO3 for different stations
#NB can of curse combine different variables for one station as well 
VT16_fosfat_Si <- VT16_TOTP +  VT16_PO4 + VT16_SIO2 +  plot_layout(ncol = 1,  width = 8, height = 6)
plot (VT16_fosfat_Si)
ggsave("Figures/VT16/VT16_fosfat_Si_panel.png", plot = VT16_fosfat_Si,  width = 8, height = 6)
```
  
```
#### VT16 klfa
```{r}
quantile (VT16$KlfA, na.rm = T)

# med punkter
grenser <- c(0,5)
VT16_KlfA <- okokyst_plot(data = VT16, varname = "KlfA", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                      scale_fill_gradientn("KlfA", colours = jet.colors(16),limits=grenser, breaks = c(1,2,3,4), oob=squish) +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VT16_KlfA 

ggsave ("Figures/VT16/VT16_KlfA.png" , width = 8, height = 3)
```




#### VT79 TOTN
```{r}

# check range, can be set automatically, but I often found the plot looks nicer if you set manually
quantile(VR48$TOTN, na.rm = T)

# with colored points and date label every 2nd month (depends on length of the timeseries for the station)
# NB! here I set the labels = null (compare with VT71 below), because I want to have them on top of eachother in a panel (see 3. Combine figures below)

grenser <- c(0,500)
VT79_TOTN <- okokyst_plot(data = VT79, varname = "TOTN", ctd_variable = F,
                   colored_points = T, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn("TOTN", colours = jet.colors(20), limits= grenser, breaks = c(100,200,300,400), oob=squish) +
                    scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VT79_TOTN

ggsave ("Figures/VT79/VT79_TOTN.png", dpi=500, width = 8, height = 3)


```



#### VT79 NO3
```{r}

quantile (VT79$NO3_NO2, na.rm = T)

# med punkter

grenser <- c(0,200)
VT79_NO3 <- okokyst_plot(data = VT79, varname = "NO3_NO2", ctd_variable = FALSE,
                   colored_points = TRUE, limits =grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("NO"[3]* "+ NO"[2]), colours = jet.colors(16), breaks = c(50,100,150), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VT79_NO3

ggsave ("Figures/VT79/VT79_NO3.png", dpi=500, width = 8, height = 3)
 
```
#### VT79 NH4
```{r}

quantile (VT79$NH4, na.rm = T)

# med punkter
grenser <- c(0,80)
VT79_NH4 <- okokyst_plot(data = VT79, varname = "NH4", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("NH"[4]), limit=grenser, colours = jet.colors(16), breaks = c(20,40,60), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", date_labels =  "%b %y") +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VT79_NH4

ggsave ("Figures/VT79/VT79_NH4.png", dpi=500, width = 8, height = 3)


```


####


## 3. Combine figures (with patchwork library)
```{r}
# combine figures, here combine two NO3 for different stations
#NB can of curse combine different variables for one station as well 
Nitrogen <- VT79_TOTN +  VT79_NO3 + VT79_NH4 + plot_layout(ncol = 1, width = 8, height =6)
plot (Nitrogen)
  ggsave("Figures/VT79/VT79_nitrogen_panel_test.png", plot = Nitrogen,  width = 8, height = 6)
  
```

####VT79 PO4

```{r}

quantile (VT79$PO4, na.rm = T)

# med punkter

grenser <- c(0,60)
VT79_PO4 <- okokyst_plot(data = VT79, varname = "PO4", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("PO"[4]), colours = jet.colors(16), limits=grenser, breaks = c(10,20,30,40,50), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)
 
                      #theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))

VT79_PO4

ggsave ("Figures/VT79/VT79_PO4.png", dpi=500, , width = 8, height = 3)
```

####VT79 TOTP
```{r}
quantile (VT79$TOTP, na.rm = T)

# med punkter

grenser <- c(0,60)
VT79_TOTP <- okokyst_plot(data = VT79, varname = "TOTP", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn("TOTP", colours = jet.colors(16), limits=grenser, breaks = c(10,20,30,40,50), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VT79_TOTP

ggsave ("Figures/VT79/VT79_TOTP.png", dpi=500, width = 8, height = 3)
```


####VT79 SIO2

```{r}

quantile (VT79$SIO2, na.rm = T)

# med punkter
grenser <- c(0,900)
VT79_SIO2 <- okokyst_plot(data = VT79, varname = "SIO2", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("SiO"[2]), colours = jet.colors(16),limits=grenser,breaks = c(200,400,600,800), oob=squish ) +
                       scale_x_datetime(date_breaks = "2 month", date_labels =  "%b %y") +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VT79_SIO2

ggsave ("Figures/VT79/VT79_SIO2.png", dpi=500, width = 8, height = 3)

```

##cOMBINE 
```{r}
# combine figures, here combine two NO3 for different stations
#NB can of curse combine different variables for one station as well 
VT79_fosfat_Si <- VT79_TOTP +  VT79_PO4 + VT79_SIO2 +  plot_layout(ncol = 1,  width = 8, height = 6)
plot (VT79_fosfat_Si)
ggsave("Figures/VT79/VT79_fosfat_Si_panel.png", plot = VT79_fosfat_Si,  width = 8, height = 6)
```
  
```
#### VT79 klfa
```{r}
quantile (VT79$KlfA, na.rm = T)

# med punkter
grenser <- c(0,5)
VT79_KlfA <- okokyst_plot(data = VT79, varname = "KlfA", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                      scale_fill_gradientn("KlfA", colours = jet.colors(16),limits=grenser, breaks = c(1,2,3,4), oob=squish) +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VT79_KlfA 

ggsave ("Figures/VT79/VT79_KlfA.png" , width = 8, height = 3)
```


#### VT70 TOTN
```{r}

# check range, can be set automatically, but I often found the plot looks nicer if you set manually
quantile(VR48$TOTN, na.rm = T)

# with colored points and date label every 2nd month (depends on length of the timeseries for the station)
# NB! here I set the labels = null (compare with VT71 below), because I want to have them on top of eachother in a panel (see 3. Combine figures below)

grenser <- c(0,500)
VT70_TOTN <- okokyst_plot(data = VT70, varname = "TOTN", ctd_variable = F,
                   colored_points = T, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn("TOTN", colours = jet.colors(20), limits= grenser, breaks = c(100,200,300,400), oob=squish) +
                    scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VT70_TOTN

ggsave ("Figures/VT70/VT70_TOTN.png", dpi=500, width = 8, height = 3)


```



#### VT70 NO3
```{r}

quantile (VT70$NO3_NO2, na.rm = T)

# med punkter

grenser <- c(0,200)
VT70_NO3 <- okokyst_plot(data = VT70, varname = "NO3_NO2", ctd_variable = FALSE,
                   colored_points = TRUE, limits =grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("NO"[3]* "+ NO"[2]),limits=grenser, colours = jet.colors(16), breaks = c(50,100,150), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VT70_NO3

ggsave ("Figures/VT70/VT70_NO3.png", dpi=500, width = 8, height = 3)
 
```
#### VT70 NH4
```{r}

quantile (VT70$NH4, na.rm = T)

# med punkter
grenser <- c(0,80)

VT70_NH4 <- okokyst_plot(data = VT70, varname = "NH4", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("NH"[4]), limit=grenser, colours = jet.colors(16), breaks = c(20,40,60), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", date_labels =  "%b %y") +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))

VT70_NH4

ggsave ("Figures/VT70/VT70_NH4.png", dpi=500, width = 8, height = 3)


```


####


## 3. Combine figures (with patchwork library)
```{r}
# combine figures, here combine two NO3 for different stations
#NB can of curse combine different variables for one station as well 
Nitrogen <- VT70_TOTN +  VT70_NO3 + VT70_NH4 + plot_layout(ncol = 1, width = 8, height =6)
plot (Nitrogen)
  ggsave("Figures/VT70/VT70_nitrogen_panel_test.png", plot = Nitrogen,  width = 8, height = 6)
  
```

####VT70 PO4

```{r}

quantile (VT70$PO4, na.rm = T)

# med punkter

grenser <- c(0,60)
VT70_PO4 <- okokyst_plot(data = VT70, varname = "PO4", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("PO"[4]), colours = jet.colors(16), limits=grenser, breaks = c(10,20,30,40,50), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)
 
                      #theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))

VT70_PO4

#ggsave ("Figures/VT70/VT70_PO4.png", dpi=500, , width = 8, height = 3)
```

####VT70 TOTP
```{r}
quantile (VT70$TOTP, na.rm = T)

# med punkter

grenser <- c(0,60)
VT70_TOTP <- okokyst_plot(data = VT70, varname = "TOTP", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn("TOTP", colours = jet.colors(16), limits=grenser, breaks = c(10,20,30,40,50), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VT70_TOTP

#ggsave ("Figures/VT70/VT70_TOTP.png", dpi=500, width = 8, height = 3)
```


####VT70 SIO2

```{r}

quantile (VT70$SIO2, na.rm = T)
rm
# med punkter
grenser <- c(0,900)
VT70_SIO2 <- okokyst_plot(data = VT70, varname = "SIO2", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("SiO"[2]), colours = jet.colors(16),limits=grenser,breaks = c(200,400,600,800), oob=squish ) +
                       scale_x_datetime(date_breaks = "2 month", date_labels =  "%b %y") +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VT70_SIO2

#ggsave ("Figures/VT70/VT70_SIO2.png", dpi=500, width = 8, height = 3)

```

##cOMBINE 
```{r}
# combine figures, here combine two NO3 for different stations
#NB can of curse combine different variables for one station as well 
VT70_fosfat_Si <- VT70_TOTP +  VT70_PO4 + VT70_SIO2 +  plot_layout(ncol = 1,  width = 8, height = 6)
plot (VT70_fosfat_Si)
ggsave("Figures/VT70/VT70_fosfat_Si_panel.png", plot = VT70_fosfat_Si,  width = 8, height = 6)
```
  
```
#### VT70 klfa
```{r}
quantile (VT70$KlfA, na.rm = T)

# med punkter
grenser <- c(0,5)
VT70_KlfA <- okokyst_plot(data = VT70, varname = "KlfA", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                      scale_fill_gradientn("KlfA", colours = jet.colors(16),limits=grenser, breaks = c(1,2,3,4), oob=squish) +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VT70_KlfA 

ggsave ("Figures/VT70/VT70_KlfA.png" , width = 8, height = 3)
```



#### VT74 TOTN
```{r}

# check range, can be set automatically, but I often found the plot looks nicer if you set manually
quantile(VR48$TOTN, na.rm = T)

# with colored points and date label every 2nd month (depends on length of the timeseries for the station)
# NB! here I set the labels = null (compare with VT71 below), because I want to have them on top of eachother in a panel (see 3. Combine figures below)

grenser <- c(0,500)
VT74_TOTN <- okokyst_plot(data = VT74, varname = "TOTN", ctd_variable = F,
                   colored_points = T, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn("TOTN", colours = jet.colors(20), limits= grenser, breaks = c(100,200,300,400), oob=squish) +
                    scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VT74_TOTN

#ggsave ("Figures/VT74/VT74_TOTN.png", dpi=500, width = 8, height = 3)


```



#### VT74 NO3
```{r}

quantile (VT74$NO3_NO2, na.rm = T)

# med punkter

grenser <- c(0,200)
VT74_NO3 <- okokyst_plot(data = VT74, varname = "NO3_NO2", ctd_variable = FALSE,
                   colored_points = TRUE, limits =grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("NO"[3]* "+ NO"[2]), colours = jet.colors(16), breaks = c(50,100,150), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VT74_NO3

#ggsave ("Figures/VT74/VT74_NO3.png", dpi=500, width = 8, height = 3)
 
```
#### VT74 NH4
```{r}

quantile (VT74$NH4, na.rm = T)

# med punkter
grenser <- c(0,80)
VT74_NH4 <- okokyst_plot(data = VT74, varname = "NH4", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("NH"[4]), limit=grenser, colours = jet.colors(16), breaks = c(20,40,60), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", date_labels =  "%b %y") +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VT74_NH4

#ggsave ("Figures/VT74/VT74_NH4.png", dpi=500, width = 8, height = 3)


```


####


## 3. Combine figures (with patchwork library)
```{r}
# combine figures, here combine two NO3 for different stations
#NB can of curse combine different variables for one station as well 
Nitrogen <- VT74_TOTN +  VT74_NO3 + VT74_NH4 + plot_layout(ncol = 1, width = 8, height =6)
plot (Nitrogen)
  ggsave("Figures/VT74/VT74_nitrogen_panel_test.png", plot = Nitrogen,  width = 8, height = 6)
  
```

####VT74 PO4

```{r}

quantile (VT74$PO4, na.rm = T)

# med punkter

grenser <- c(0,60)
VT74_PO4 <- okokyst_plot(data = VT74, varname = "PO4", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("PO"[4]), colours = jet.colors(16), limits=grenser, breaks = c(10,20,30,40,50), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)
 
                      #theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))

VT74_PO4

#ggsave ("Figures/VT74/VT74_PO4.png", dpi=500, , width = 8, height = 3)
```

####VT74 TOTP
```{r}
quantile (VT74$TOTP, na.rm = T)

# med punkter

grenser <- c(0,60)
VT74_TOTP <- okokyst_plot(data = VT74, varname = "TOTP", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn("TOTP", colours = jet.colors(16), limits=grenser, breaks = c(10,20,30,40,50), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VT74_TOTP

#ggsave ("Figures/VT74/VT74_TOTP.png", dpi=500, width = 8, height = 3)
```


####VT74 SIO2

```{r}

quantile (VT74$SIO2, na.rm = T)
rm
# med punkter
grenser <- c(0,900)
VT74_SIO2 <- okokyst_plot(data = VT74, varname = "SIO2", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("SiO"[2]), colours = jet.colors(16),limits=grenser,breaks = c(200,400,600,800), oob=squish ) +
                       scale_x_datetime(date_breaks = "2 month", date_labels =  "%b %y") +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VT74_SIO2

#ggsave ("Figures/VT74/VT74_SIO2.png", dpi=500, width = 8, height = 3)

```

##cOMBINE 
```{r}
# combine figures, here combine two NO3 for different stations
#NB can of curse combine different variables for one station as well 
VT74_fosfat_Si <- VT74_TOTP +  VT74_PO4 + VT74_SIO2 +  plot_layout(ncol = 1,  width = 8, height = 6)
plot (VT74_fosfat_Si)
ggsave("Figures/VT74/VT74_fosfat_Si_panel.png", plot = VT74_fosfat_Si,  width = 8, height = 6)
```
  
```
#### VT74 klfa
```{r}
quantile (VT74$KlfA, na.rm = T)

# med punkter
grenser <- c(0,5)
VT74_KlfA <- okokyst_plot(data = VT74, varname = "KlfA", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                      scale_fill_gradientn("KlfA", colours = jet.colors(16),limits=grenser, breaks = c(1,2,3,4), oob=squish) +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VT74_KlfA 

ggsave ("Figures/VT74/VT74_KlfA.png" , width = 8, height = 3)
```



#### VR49 TOTN
```{r}

# check range, can be set automatically, but I often found the plot looks nicer if you set manually
quantile(VR48$TOTN, na.rm = T)

# with colored points and date label every 2nd month (depends on length of the timeseries for the station)
# NB! here I set the labels = null (compare with VT71 below), because I want to have them on top of eachother in a panel (see 3. Combine figures below)

grenser <- c(0,500)
VR49_TOTN <- okokyst_plot(data = VR49, varname = "TOTN", ctd_variable = F,
                   colored_points = T, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn("TOTN", colours = jet.colors(20), limits= grenser, breaks = c(100,200,300,400), oob=squish) +
                    scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VR49_TOTN

#ggsave ("Figures/VR49/VR49_TOTN.png", dpi=500, width = 8, height = 3)


```



#### VR49 NO3
```{r}

quantile (VR49$NO3_NO2, na.rm = T)

# med punkter

grenser <- c(0,200)
VR49_NO3 <- okokyst_plot(data = VR49, varname = "NO3_NO2", ctd_variable = FALSE,
                   colored_points = TRUE, limits =grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("NO"[3]* "+ NO"[2]), colours = jet.colors(16), breaks = c(50,100,150), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VR49_NO3

#ggsave ("Figures/VR49/VR49_NO3.png", dpi=500, width = 8, height = 3)
 
```
#### VR49 NH4
```{r}

quantile (VR49$NH4, na.rm = T)

# med punkter
grenser <- c(0,80)
VR49_NH4 <- okokyst_plot(data = VR49, varname = "NH4", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("NH"[4]), limit=grenser, colours = jet.colors(16), breaks = c(20,40,60), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", date_labels =  "%b %y") +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VR49_NH4

#ggsave ("Figures/VR49/VR49_NH4.png", dpi=500, width = 8, height = 3)


```


####


## 3. Combine figures (with patchwork library)
```{r}
# combine figures, here combine two NO3 for different stations
#NB can of curse combine different variables for one station as well 
Nitrogen <- VR49_TOTN +  VR49_NO3 + VR49_NH4 + plot_layout(ncol = 1, width = 8, height =6)
plot (Nitrogen)
  ggsave("Figures/VR49/VR49_nitrogen_panel_test.png", plot = Nitrogen,  width = 8, height = 6)
  
```

####VR49 PO4

```{r}

quantile (VR49$PO4, na.rm = T)

# med punkter

grenser <- c(0,60)
VR49_PO4 <- okokyst_plot(data = VR49, varname = "PO4", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("PO"[4]), colours = jet.colors(16), limits=grenser, breaks = c(10,20,30,40,50), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)
 
                      #theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))

VR49_PO4

#ggsave ("Figures/VR49/VR49_PO4.png", dpi=500, , width = 8, height = 3)
```

####VR49 TOTP
```{r}
quantile (VR49$TOTP, na.rm = T)

# med punkter

grenser <- c(0,60)
VR49_TOTP <- okokyst_plot(data = VR49, varname = "TOTP", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn("TOTP", colours = jet.colors(16), limits=grenser, breaks = c(10,20,30,40,50), oob=squish) +
                      scale_x_datetime(date_breaks = "2 month", labels =  NULL)

VR49_TOTP

#ggsave ("Figures/VR49/VR49_TOTP.png", dpi=500, width = 8, height = 3)
```


####VR49 SIO2

```{r}

quantile (VR49$SIO2, na.rm = T)
rm
# med punkter
grenser <- c(0,900)
VR49_SIO2 <- okokyst_plot(data = VR49, varname = "SIO2", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                    scale_fill_gradientn(name= expression("SiO"[2]), colours = jet.colors(16),limits=grenser,breaks = c(200,400,600,800), oob=squish ) +
                       scale_x_datetime(date_breaks = "2 month", date_labels =  "%b %y") +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VR49_SIO2

#ggsave ("Figures/VR49/VR49_SIO2.png", dpi=500, width = 8, height = 3)

```

##cOMBINE 
```{r}
# combine figures, here combine two NO3 for different stations
#NB can of curse combine different variables for one station as well 
VR49_fosfat_Si <- VR49_TOTP +  VR49_PO4 + VR49_SIO2 +  plot_layout(ncol = 1,  width = 8, height = 6)
plot (VR49_fosfat_Si)
ggsave("Figures/VR49/VR49_fosfat_Si_panel.png", plot = VR49_fosfat_Si,  width = 8, height = 6)
```
  
```
#### VR49 klfa
```{r}
quantile (VR49$KlfA, na.rm = T)

# med punkter
grenser <- c(0,5)
VR49_KlfA <- okokyst_plot(data = VR49, varname = "KlfA", ctd_variable = FALSE,
                   colored_points = TRUE, limits = grenser, binwidth = 20, max_timediff = 25, ylabel = F, xlabel = F) +
                      scale_fill_gradientn("KlfA", colours = jet.colors(16),limits=grenser, breaks = c(1,2,3,4), oob=squish) +
                      theme(axis.text.x=element_text(angle=60, hjust=1), plot.title = element_text(hjust = 0.5))
VR49_KlfA 

ggsave ("Figures/VR49/VR49_KlfA.png" , width = 8, height = 3)
```





